<!DOCTYPE html>
<html>
    <head>
        <title>Create Alert</title>
        <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
        }
        .section {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 15px;
        }
        .hidden {
            display: none;
        }
        label {
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            margin-top: 5px;
            margin-bottom: 10px;
            padding: 6px;
        }
        </style>
        <script>
        function toggleActionConfig() {
            document.getElementById("email_config").style.display =
                document.getElementById("email_action").checked ? "block" : "none";

            document.getElementById("sn_config").style.display =
                document.getElementById("sn_action").checked ? "block" : "none";
        }
        </script>
    </head>
    <body>
        <h2>Create Alert</h2>
        <form method="POST">
            <!-- ================= ALERT RULE ================= -->
            <div class="section">
                <h3>Alert Rule</h3>
                <label>Alert Name</label>
                <input type="text"
                       name="name"
                       placeholder="e.g. Database Error Alert"
                       required>
                <label>Keyword / Pattern</label>
                <input type="text"
                       name="keyword"
                       placeholder="e.g. ERROR OR Timeout"
                       required>
                <label>Search Interval (minutes)</label>
                <input type="number" name="interval_minutes" min="1" value="5" required>
                <label>
                    <input type="checkbox" name="enabled" checked>
                    Enable Alert
                </label>
            </div>
            <!-- ================= ACTION SELECTION ================= -->
            <div class="section">
                <h3>Alert Actions</h3>
                <label>
                    <input type="checkbox"
                           id="email_action"
                           name="email_action"
                           onclick="toggleActionConfig()">
                    Email Alert
                </label>
                <br>
                <label>
                    <input type="checkbox"
                           id="sn_action"
                           name="sn_action"
                           onclick="toggleActionConfig()">
                    ServiceNow Incident
                </label>
            </div>
            <!-- ================= EMAIL CONFIG ================= -->
            <div id="email_config" class="section hidden">
                <h3>Email Configuration</h3>
                <label>Recipients</label>
                <input type="text"
                       name="email_to"
                       placeholder="ops@company.com, dev@company.com">
                <label>Email Subject</label>
                <input type="text"
                       name="email_subject"
                       value="Log Alert Triggered: {{ keyword }}">
                <label>Email Body</label>
                <textarea name="email_body" rows="6">
            Alert Name: {{alert_name}}

            Log Message:
            {{log_message}}

            Timestamp:
            {{timestamp}}
</textarea>
                <label>Email Importance</label>
                <select name="email_importance">
                    <option value="low">Low</option>
                    <option value="normal" selected>Normal</option>
                    <option value="high">High</option>
                </select>
                <label>
                    <input type="checkbox" name="email_include_log" checked>
                    Include matched log content
                </label>
                <label>Throttle (minutes)</label>
                <input type="number" name="email_throttle" placeholder="e.g. 10">
            </div>
            <!-- ================= SERVICENOW CONFIG ================= -->
            <div id="sn_config" class="section hidden">
                <h3>ServiceNow Configuration</h3>
                <label>Incident Priority</label>
                <select name="sn_priority">
                    <option value="1">P1 - Critical</option>
                    <option value="2" selected>P2 - High</option>
                    <option value="3">P3 - Medium</option>
                    <option value="4">P4 - Low</option>
                </select>
                <label>Short Description</label>
                <input type="text" name="sn_short_desc" value="Log Alert: {{ keyword }}">
                <label>Description</label>
                <textarea name="sn_description" rows="6">
            Alert triggered for keyword: {{keyword}}

            Log Message:
            {{log_message}}

            Source: Log Monitoring Tool
</textarea>
                <label>
                    <input type="checkbox" name="sn_include_log" checked>
                    Include log details in incident
                </label>
                <label>Assignment Group (Optional)</label>
                <input type="text" name="sn_assignment_group" placeholder="IT-Ops">
                <label>Category (Optional)</label>
                <input type="text" name="sn_category" placeholder="Application">
                <label>Throttle (minutes)</label>
                <input type="number" name="email_throttle" placeholder="e.g. 10">
            </div>
            <!-- ================= SUBMIT ================= -->
            <br>
            <button type="submit">Create Alert</button>
        </form>
        <br>
        <a href="{{ url_for('auth.dashboard') }}">Back to Dashboard</a>
    </body>
</html>
